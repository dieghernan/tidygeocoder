---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file directly and reknit -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  fig.width = 8,
  fig.height = 5,
  fig.align = 'center'
)
options(tibble.print_min = 5, tibble.print_max = 5)
```

# tidygeocoder <a href='https://jessecambon.github.io/tidygeocoder/'><img src="man/figures/tidygeocoder_hex.png" align="right" height="139"/></a>

<!-- badges: start -->

[![Project Status: Active â€“ The project has reached a stable, usable state and is being actively developed.](https://www.repostatus.org/badges/latest/active.svg)](https://www.repostatus.org/#active) [![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://github.com/jessecambon/tidygeocoder/blob/master/LICENSE.md) [![CRAN](https://www.r-pkg.org/badges/version/tidygeocoder)](https://cran.r-project.org/package=tidygeocoder) [![CRAN Total Downloads](http://cranlogs.r-pkg.org/badges/grand-total/tidygeocoder)](https://CRAN.R-project.org/package=tidygeocoder) [![CRAN Downloads Per Month](http://cranlogs.r-pkg.org/badges/tidygeocoder)](https://cran.r-project.org/package=tidygeocoder) [![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.4448251.svg)](https://doi.org/10.5281/zenodo.4448251) <!--[![Github Stars](https://img.shields.io/github/stars/jessecambon/tidygeocoder?style=social&label=Github)](https://github.com/jessecambon/tidygeocoder) -->

<!-- badges: end -->

## Introduction

Tidygeocoder makes getting data from geocoder services easy. Both *forward geocoding* (providing addresses to obtain geographic coordinates) and *reverse geocoding* (providing geographic coordinates to obtain addresses) are supported. All results are returned in [tibble format](https://tibble.tidyverse.org/) and the supported geocoder services are listed below.

Batch geocoding (geocoding multiple addresses or coordinates per query) is used by default if supported by the geocoder service when multiple inputs (addresses or coordinates) are provided. Duplicate, missing/NA, and blank input data is handled elegantly - only unique inputs are passed to geocoder services, but the rows in the original data are preserved by default.

Some useful references:

- [Blog posts on tidygeocoder](https://jessecambon.github.io/tag/tidygeocoder) for updates on releases and more usage examples. In particular [this post](https://jessecambon.github.io/2020/07/15/tidygeocoder-1-0-0.html) and [this post](https://jessecambon.github.io/2019/11/11/tidygeocoder-demo.html) demonstrate some relevant mapping workflows.
- [Getting Started Vignette](https://jessecambon.github.io/tidygeocoder/articles/tidygeocoder.html) for more detailed and comprehensive usage examples. 
- [Reference Datasets](https://jessecambon.github.io/tidygeocoder/articles/api_reference.html) to view the built-in datasets that are used by tidygeocoder to set key parameters and settings for geocoder queries.

## Installation

To install the stable version from CRAN (the official R package servers):

```{r, eval=F}
install.packages('tidygeocoder')
```

Alternatively, you can install the latest development version from GitHub:

```{r, eval=F}
if(!require(devtools)) install.packages("devtools")
devtools::install_github("jessecambon/tidygeocoder")
```

## Geocoder Services

The supported geocoder services are shown in the table below with their geographic limitations, if they support batch geocoding (geocoding multiple addresses or coordinates in a single query), if an API key is required, and the usage rate limitations. Refer to the website for each geocoder service for the most up-to-date details on costs, capabilities, and usage limitations. 

**Summary:**

- The Census and Nominatim (OSM) services are free and do not require an API key. 
- ArcGIS can be used for free without an API key, but some features require a paid subscription and API key.
- The Geocodio, Location IQ, OpenCage, Mapbox, HERE, TomTom, MapQuest, and Bing are commercial services that offer free tiers.
- The Google service has no free tier and [bills per query](https://developers.google.com/maps/documentation/geocoding/usage-and-billing).

| Service                                                                       | Geography     | Batch Geocoding | API Key Required | Query Rate Limit        |
|-------------------------------------------------------------------------------|---------------|-----------------|------------------|-------------------------|
| [US Census](https://geocoding.geo.census.gov/)                                | US            | Yes             | No               | None                    |
| [Nominatim (OSM)](https://nominatim.org)                                      | Worldwide     | No              | No               | 1/second                |
| [ArcGIS](https://developers.arcgis.com/rest/geocode/api-reference/overview-world-geocoding-service.htm)   | Worldwide        | See Note             | See Note               | None    |
| [Geocodio](https://www.geocod.io/)                                            | US and Canada | Yes             | Yes              | 1000/minute (free tier) |
| [Location IQ](https://locationiq.com/)                                        | Worldwide     | No              | Yes              | 2/second (free tier)    |
| [Google](https://developers.google.com/maps/documentation/geocoding/overview) | Worldwide     | No              | Yes              | 50/second               |
| [OpenCage](https://opencagedata.com)                                          | Worldwide     | No              | Yes              | 1/second (free tier)    |
| [Mapbox](https://docs.mapbox.com/api/search/)                                             | Worldwide     | See Note        | Yes              | 10/second (free tier)   |
| [HERE](https://developer.here.com/products/geocoding-and-search)              | Worldwide     | Yes             | Yes              | None                    |
| [TomTom](https://developer.tomtom.com/search-api/search-api-documentation/geocoding)                                       | Worldwide     | Yes             | Yes              | 5/second (free tier)    |
| [MapQuest](https://developer.mapquest.com/documentation/geocoding-api/)                                       | Worldwide     | Yes             | Yes              | None    |
| [Bing](https://docs.microsoft.com/en-us/bingmaps/rest-services/locations/)                                       | Worldwide     | Yes             | Yes              | None    |


**Notes:**

- The US Census service supports street-level addresses only (ie. "11 Wall St New York, NY" is OK but "New York, NY" is not).
- The Census geocoder is the only supported service that does not offer reverse geocoding.
- The Mapbox service is capable of performing batch geocoding when using the [permanent endpoint](https://docs.mapbox.com/api/search/geocoding/#batch-geocoding), but this capability is not currently implemented in tidygeocoder. If you'd like to add this capability to the package see [issue \#73](https://github.com/jessecambon/tidygeocoder/issues/73).
- For the ArcGIS service, an API Key is not strictly required if the service is used
for search capabilities only (see [Free vs. paid operations](https://developers.arcgis.com/rest/geocode/api-reference/geocoding-free-vs-paid.htm)). It is possible to include an API Key on the request via the `custom_query` parameter:

```r
tidygeocoder::geo(
  address = "New York, USA", method = "arcgis",
  custom_query = list(
    token = "<API_KEY>"
  )
)
```
-   The ArcGIS service is capable of performing [batch geocoding](https://developers.arcgis.com/rest/geocode/api-reference/geocoding-geocode-addresses.htm) 
but this capability is not currently implemented in tidygeocoder.

## Usage

In this example we will geocode a few addresses using the `geocode()` function and plot them on a map with ggplot.

```{r, warning = F, message = F}
library(dplyr)
library(tibble)
library(tidygeocoder)

# create a dataframe with addresses
some_addresses <- tribble(
~name,                  ~addr,
"White House",          "1600 Pennsylvania Ave NW, Washington, DC",
"Transamerica Pyramid", "600 Montgomery St, San Francisco, CA 94111",     
"Willis Tower",         "233 S Wacker Dr, Chicago, IL 60606"                                  
)

# geocode the addresses
lat_longs <- some_addresses %>%
  geocode(addr, method = 'census', lat = latitude , long = longitude)
```

The `geocode()` function attaches latitude and longitude columns to our input dataset of addresses. The US Census geocoder is used here, but other services can be specified with the `method` argument. See the `geo()` function documentation for details.

```{r, echo = FALSE}
knitr::kable(lat_longs)
```

Now that we have the longitude and latitude coordinates, we can use ggplot to plot our addresses on a map.

```{r usamap}
library(ggplot2)
library(maps)
library(ggrepel)

ggplot(lat_longs, aes(longitude, latitude), color = "grey99") +
  borders("state") + geom_point() + 
  geom_label_repel(aes(label = name)) + 
  theme_void()
```

To return the full results from a geocoder service (not just latitude and longitude) you can use `full_results = TRUE`. Additionally, for the Census geocoder you can use `return_type = 'geographies'` to return geography columns (state, county, Census tract, and Census block).

```{r}
full <- some_addresses %>%
  geocode(addr, method = 'census', full_results = TRUE, 
          return_type = 'geographies')
```

```{r, echo = FALSE}
knitr::kable(full)
```

To perform **reverse geocoding** (obtaining addresses from latitude and longitude coordinates), we can use the `reverse_geocode()` function. The arguments are similar to the `geocode()` function, but we now are specifying the latitude and longitude columns in our dataset with the `lat` and `long` arguments. The single line address is returned in a column named by the `address` argument. See the `reverse_geo()` function documentation for more details on reverse geocoding.

```{r}
coordinates <- tibble(latitude = c(38.895865, 43.6534817, 35.0844),
                longitude = c(-77.0307713, -79.3839347, -106.6504))

rev1 <- coordinates %>%
  reverse_geocode(lat = latitude, long = longitude, method = 'osm',
                  address = address_found, full_results = TRUE)
```

```{r, echo = FALSE}
knitr::kable(rev1)
```

For further documentation, refer to the [Getting Started Vignette](https://jessecambon.github.io/tidygeocoder/articles/tidygeocoder.html) and the [function documentation](https://jessecambon.github.io/tidygeocoder/reference/index.html).

## Contributing

Contributions to the tidygeocoder package are welcome. File [an issue](https://github.com/jessecambon/tidygeocoder/issues) for bug fixes or suggested features. If you would like to add support for a new geocoder service, reference [this post](https://github.com/jessecambon/tidygeocoder/issues/62#issue-777707424) for instructions.

## Citing tidygeocoder

```{r}
citation('tidygeocoder')
```

Or refer to the [citation page](https://jessecambon.github.io/tidygeocoder/authors.html).
